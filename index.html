<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OPHS Course Explorer - Orchard Park High School</title>
    <meta name="description" content="Explore courses at Orchard Park High School. Find the perfect classes for your academic journey with our interactive course catalog.">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .handbook-link {
            position: absolute;
            top: 20px;
            right: 30px;
            background: #8B1538;
            color: white;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 21, 56, 0.3);
        }

        .handbook-link:hover {
            background: #A01B47;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 21, 56, 0.4);
        }

        .header h1 {
            color: #8B1538;
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 0;
        }

        .form-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            background: white;
            transition: all 0.3s ease;
        }

        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            user-select: none;
        }

        .checkbox-item:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .checkbox-item:active {
            transform: translateY(0);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
            accent-color: #667eea;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 500;
        }

        .courses-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .courses-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }

        .courses-title {
            color: #8B1538;
            font-size: 2.2em;
            font-weight: 700;
        }

        .course-count {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1.1em;
        }

        .course-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .course-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .course-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .course-title {
            color: #8B1538;
            font-size: 1.4em;
            font-weight: 700;
            margin: 0;
            flex: 1;
        }

        .course-meta {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .meta-item {
            background: #f8f9fa;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
            color: #495057;
        }

        .course-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .course-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }

        .department-header {
            background: linear-gradient(135deg, #8B1538, #A01B47);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 30px 0 20px 0;
            text-align: center;
        }

        .department-title {
            font-size: 1.8em;
            font-weight: 700;
            margin: 0;
        }

        .no-courses {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .no-courses h3 {
            color: #8B1538;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .filter-summary {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 0 10px 10px 0;
            margin: 20px 0;
        }

        .clear-filters {
            background: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .clear-filters:hover {
            background: #f57c00;
            transform: translateY(-2px);
        }

        .disclaimer {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 8px 15px;
            text-align: center;
            font-size: 0.9em;
            border-radius: 0;
            margin: 0;
        }

        .disclaimer strong {
            color: #8B1538;
        }

        .hidden {
            display: none !important;
        }

        .selected-courses-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid #4caf50;
        }

        .selected-courses-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e8;
        }

        .selected-courses-title {
            color: #4caf50;
            font-size: 1.8em;
            font-weight: 700;
            margin: 0;
        }

        .selected-count {
            background: #4caf50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 1em;
        }

        .copy-clipboard-btn {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .copy-clipboard-btn:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .copy-clipboard-btn:active {
            transform: translateY(0);
        }

        .copy-clipboard-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .selected-course-item {
            background: #f8fff8;
            border: 1px solid #4caf50;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .selected-course-item:hover {
            background: #e8f5e8;
            transform: translateX(5px);
        }

        .selected-course-title {
            color: #2e7d32;
            font-weight: 600;
            flex: 1;
        }

        .selected-course-meta {
            color: #666;
            font-size: 0.9em;
            margin-right: 15px;
        }

        .remove-course-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .remove-course-btn:hover {
            background: #d32f2f;
            transform: scale(1.05);
        }

        .empty-selection {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #ddd;
        }

        .course-card.selected {
            border-color: #4caf50;
            background: #f8fff8;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2);
        }

        .course-card.selected:hover {
            border-color: #45a049;
        }

        .course-selection-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: bold;
        }

        .course-card.selected .course-selection-indicator {
            background: #4caf50;
            border-color: #4caf50;
            color: white;
        }

        .copy-success {
            background: linear-gradient(135deg, #2e7d32, #388e3c) !important;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            
            .form-container, .courses-container {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .handbook-link {
                position: static;
                margin: 0 auto 20px auto;
                font-size: 1em;
                padding: 8px 12px;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .courses-header {
                flex-direction: column;
                text-align: center;
            }

            .disclaimer {
                font-size: 0.8em;
                padding: 6px 10px;
            }

            .selected-courses-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .copy-clipboard-btn {
                width: 100%;
                justify-content: center;
            }

            .selected-course-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .selected-course-meta {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="disclaimer">
        ⚠️ <strong>Unofficial Site</strong> - This course explorer is for reference only. Please verify all course information with your school counselor and the <a href="https://ophs.opschools.org/school-counseling/curriculum-handbook-ophs" target="_blank" rel="noopener noreferrer" style="color: #8B1538; text-decoration: underline;">official OPHS curriculum handbook</a>.
    </div>
    <div class="container">
        <div class="header">
            <a href="https://ophs.opschools.org/school-counseling/curriculum-handbook-ophs" class="handbook-link" target="_blank" rel="noopener noreferrer" title="View Official OPHS Curriculum Handbook">
                📚 Course Handbook
            </a>
            <h1>🎓 OPHS Course Explorer</h1>
            <p>Discover your academic pathway at Orchard Park High School</p>
        </div>

        <div class="form-container">
            <div class="form-group">
                <label for="gradeLevel">Current Grade Level:</label>
                <select id="gradeLevel">
                    <option value="">All Grades</option>
                    <option value="9">9th Grade (Freshman)</option>
                    <option value="10">10th Grade (Sophomore)</option>
                    <option value="11">11th Grade (Junior)</option>
                    <option value="12">12th Grade (Senior)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="diplomaType">Diploma Goal:</label>
                <select id="diplomaType">
                    <option value="">Any Diploma Type</option>
                    <option value="regents">Regents Diploma</option>
                    <option value="advanced_regents">Advanced Regents Diploma</option>
                </select>
            </div>

            <div class="form-group">
                <label for="department">Department (check to filter):</label>
                <div class="checkbox-group" id="departmentCheckboxes">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <div class="form-group">
                <label for="interests">Interest Areas (check to filter):</label>
                <div class="checkbox-group" id="interestCheckboxes">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <div class="form-group">
                <label for="academicLevel">Preferred Academic Challenge Level:</label>
                <select id="academicLevel">
                    <option value="">All Levels</option>
                    <option value="Various">Standard Level</option>
                    <option value="Honors">Honors Level</option>
                    <option value="AP">Advanced Placement (AP)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="prerequisites">Prerequisites:</label>
                <select id="prerequisites">
                    <option value="">All Courses</option>
                    <option value="none">📚 Courses with No Prerequisites</option>
                    <option value="has">📋 Courses with Prerequisites</option>
                </select>
            </div>

            <div id="filterSummary" class="filter-summary" style="display: none;">
                <strong>Active Filters:</strong> <span id="filterText"></span>
                <button id="clearFilters" class="clear-filters" style="margin-left: 15px;">Clear All Filters</button>
            </div>
        </div>

        <div class="selected-courses-container" id="selectedCoursesContainer" style="display: none;">
            <div class="selected-courses-header">
                <h2 class="selected-courses-title">📚 Selected Courses</h2>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="selected-count" id="selectedCount">0 courses selected</div>
                    <button id="copyClipboardBtn" class="copy-clipboard-btn" disabled>
                        📋 Copy Course List
                    </button>
                </div>
            </div>
            
            <div id="selectedCourses">
                <div class="empty-selection" id="emptySelection">
                    Click on course cards below to select them for your schedule planning
                </div>
            </div>
        </div>

        <div class="courses-container">
            <div class="courses-header">
                <h2 class="courses-title">📚 Available Courses</h2>
                <div class="course-count" id="courseCount">Loading courses...</div>
            </div>
            
            <div id="noCourses" class="no-courses" style="display: none;">
                <h3>No courses match your current filters</h3>
                <p>Try adjusting your criteria or clearing some filters to see more options.</p>
            </div>

            <div id="allCourses"></div>
        </div>
    </div>

    <script>
        let courses = [];
        let departments = new Set();
        let interestAreas = new Set();
        let selectedCourses = new Set();

        // Load course data from JSON file
        async function loadCourseData() {
            try {
                const response = await fetch('data/course-catalog.json');
                const data = await response.json();
                courses = data.courses;
                
                // Extract unique departments and interest areas
                courses.forEach(course => {
                    departments.add(course.department);
                    if (course.interest_areas) {
                        course.interest_areas.forEach(interest => {
                            interestAreas.add(interest);
                        });
                    }
                });
                
                setupDepartmentCheckboxes();
                setupInterestCheckboxes();
                renderCourses();
                setupEventListeners();
                
                console.log(`Loaded ${courses.length} courses from course catalog`);
            } catch (error) {
                console.error('Error loading course data:', error);
                document.getElementById('courseCount').textContent = 'Error loading courses';
            }
        }

        function setupDepartmentCheckboxes() {
            const container = document.getElementById('departmentCheckboxes');
            const sortedDepartments = Array.from(departments).sort();
            
            sortedDepartments.forEach(dept => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `dept-${dept.replace(/\s+/g, '-').toLowerCase()}`;
                checkbox.name = 'departments';
                checkbox.value = dept;
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = dept;
                
                // Make the entire area clickable
                checkboxItem.addEventListener('click', (e) => {
                    // Prevent double-triggering if clicking directly on checkbox or label
                    if (e.target === checkbox || e.target === label) {
                        return;
                    }
                    checkbox.checked = !checkbox.checked;
                    filterCourses();
                });
                
                checkboxItem.appendChild(checkbox);
                checkboxItem.appendChild(label);
                container.appendChild(checkboxItem);
            });
        }

        function setupInterestCheckboxes() {
            const container = document.getElementById('interestCheckboxes');
            const sortedInterests = Array.from(interestAreas).sort();
            
            sortedInterests.forEach(interest => {
                const checkboxItem = document.createElement('div');
                checkboxItem.className = 'checkbox-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `interest-${interest.replace(/\s+/g, '-').toLowerCase()}`;
                checkbox.name = 'interests';
                checkbox.value = interest;
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = interest;
                
                // Make the entire area clickable
                checkboxItem.addEventListener('click', (e) => {
                    // Prevent double-triggering if clicking directly on checkbox or label
                    if (e.target === checkbox || e.target === label) {
                        return;
                    }
                    checkbox.checked = !checkbox.checked;
                    filterCourses();
                });
                
                checkboxItem.appendChild(checkbox);
                checkboxItem.appendChild(label);
                container.appendChild(checkboxItem);
            });
        }

        function renderCourses() {
            const allCoursesContainer = document.getElementById('allCourses');
            allCoursesContainer.innerHTML = '';
            
            // Group courses by department
            const coursesByDept = {};
            courses.forEach(course => {
                if (!coursesByDept[course.department]) {
                    coursesByDept[course.department] = [];
                }
                coursesByDept[course.department].push(course);
            });
            
            // Render each department
            Object.keys(coursesByDept).sort().forEach(dept => {
                const departmentDiv = document.createElement('div');
                departmentDiv.className = 'department-section';
                departmentDiv.dataset.department = dept;
                
                const departmentHeader = document.createElement('div');
                departmentHeader.className = 'department-header';
                departmentHeader.innerHTML = `<h3 class="department-title">${dept}</h3>`;
                departmentDiv.appendChild(departmentHeader);
                
                coursesByDept[dept].forEach(course => {
                    const courseCard = createCourseCard(course);
                    departmentDiv.appendChild(courseCard);
                });
                
                allCoursesContainer.appendChild(departmentDiv);
            });
            
            // Update course count
            document.getElementById('courseCount').textContent = `${courses.length} courses available`;
        }

        function createCourseCard(course) {
            const card = document.createElement('div');
            card.className = 'course-card';
            card.dataset.courseId = course.id;
            card.dataset.department = course.department;
            
            const gradeText = course.grade_levels.join(', ');
            const academicLevelText = Array.isArray(course.academic_levels) ? course.academic_levels.join(', ') : course.academic_levels;
            const diplomaTypeText = course.diploma_types.join(', ');
            
            card.innerHTML = `
                <div class="course-selection-indicator">+</div>
                <div class="course-header">
                    <h3 class="course-title">${course.title}</h3>
                </div>
                <div class="course-meta">
                    <span class="meta-item">📊 ${course.credits} credit${course.credits !== 1 ? 's' : ''}</span>
                    <span class="meta-item">🎓 Grade${course.grade_levels.length > 1 ? 's' : ''} ${gradeText}</span>
                    <span class="meta-item">📈 ${academicLevelText}</span>
                </div>
                <div class="course-description">${course.description}</div>
                <div class="course-meta">
                    <span class="meta-item"><strong>Prerequisites:</strong> ${course.prerequisites}</span>
                </div>
                <div class="course-tags">
                    ${course.interest_areas.map(area => `<span class="tag">${area}</span>`).join('')}
                </div>
            `;
            
            // Add click handler for course selection
            card.addEventListener('click', (e) => {
                // Prevent selection when clicking on tags (which might have their own functionality)
                if (e.target.classList.contains('tag')) return;
                
                toggleCourseSelection(course.id);
            });
            
            // Update selection state if this course is already selected
            if (selectedCourses.has(course.id)) {
                card.classList.add('selected');
                card.querySelector('.course-selection-indicator').textContent = '✓';
            }
            
            return card;
        }

        function setupEventListeners() {
            document.getElementById('gradeLevel').addEventListener('change', filterCourses);
            document.getElementById('diplomaType').addEventListener('change', filterCourses);
            document.getElementById('academicLevel').addEventListener('change', filterCourses);
            document.getElementById('prerequisites').addEventListener('change', filterCourses);
            document.getElementById('clearFilters').addEventListener('click', clearAllFilters);
            document.getElementById('copyClipboardBtn').addEventListener('click', copyCoursesToClipboard);
            
            // Add event listeners to department checkboxes
            document.querySelectorAll('input[name="departments"]').forEach(checkbox => {
                checkbox.addEventListener('change', filterCourses);
            });
            
            // Add event listeners to interest checkboxes
            document.querySelectorAll('input[name="interests"]').forEach(checkbox => {
                checkbox.addEventListener('change', filterCourses);
            });
        }

        function filterCourses() {
            const gradeLevel = document.getElementById('gradeLevel').value;
            const diplomaType = document.getElementById('diplomaType').value;
            const academicLevel = document.getElementById('academicLevel').value;
            const prerequisitesFilter = document.getElementById('prerequisites').value;
            
            const selectedDepartments = Array.from(document.querySelectorAll('input[name="departments"]:checked'))
                .map(cb => cb.value);
            
            const selectedInterests = Array.from(document.querySelectorAll('input[name="interests"]:checked'))
                .map(cb => cb.value);
            
            let visibleCourses = 0;
            const departmentCounts = {};
            
            // Helper function to check if course has no prerequisites
            function hasNoPrerequisites(prerequisite) {
                const cleanPrereq = prerequisite.toLowerCase().trim();
                return cleanPrereq === 'none' || 
                       cleanPrereq.startsWith('none (') ||
                       cleanPrereq.includes('none');
            }
            
            // Filter each course
            document.querySelectorAll('.course-card').forEach(card => {
                const courseId = card.dataset.courseId;
                const course = courses.find(c => c.id === courseId);
                let shouldShow = true;
                
                // Filter by grade level
                if (gradeLevel && !course.grade_levels.includes(parseInt(gradeLevel))) {
                    shouldShow = false;
                }
                
                // Filter by diploma type
                if (diplomaType && !course.diploma_types.includes(diplomaType)) {
                    shouldShow = false;
                }
                
                // Filter by academic level
                if (academicLevel) {
                    const levels = Array.isArray(course.academic_levels) ? course.academic_levels : [course.academic_levels];
                    if (!levels.includes(academicLevel)) {
                        shouldShow = false;
                    }
                }
                
                // Filter by prerequisites
                if (prerequisitesFilter) {
                    const courseHasNoPrereqs = hasNoPrerequisites(course.prerequisites);
                    if (prerequisitesFilter === 'none' && !courseHasNoPrereqs) {
                        shouldShow = false;
                    } else if (prerequisitesFilter === 'has' && courseHasNoPrereqs) {
                        shouldShow = false;
                    }
                }
                
                // Filter by department
                if (selectedDepartments.length > 0 && !selectedDepartments.includes(course.department)) {
                    shouldShow = false;
                }
                
                // Filter by interest areas
                if (selectedInterests.length > 0) {
                    const hasMatchingInterest = selectedInterests.some(interest => 
                        course.interest_areas && course.interest_areas.includes(interest)
                    );
                    if (!hasMatchingInterest) {
                        shouldShow = false;
                    }
                }
                
                // Show/hide course
                if (shouldShow) {
                    card.classList.remove('hidden');
                    visibleCourses++;
                    
                    // Count courses per department
                    if (!departmentCounts[course.department]) {
                        departmentCounts[course.department] = 0;
                    }
                    departmentCounts[course.department]++;
                } else {
                    card.classList.add('hidden');
                }
            });
            
            // Show/hide department sections
            document.querySelectorAll('.department-section').forEach(section => {
                const department = section.dataset.department;
                if (departmentCounts[department] > 0) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });
            
            // Update course count
            document.getElementById('courseCount').textContent = `${visibleCourses} courses available`;
            
            // Show/hide "no courses" message
            const noCourses = document.getElementById('noCourses');
            if (visibleCourses === 0) {
                noCourses.style.display = 'block';
            } else {
                noCourses.style.display = 'none';
            }
            
            updateFilterSummary();
        }

        function updateFilterSummary() {
            const gradeLevel = document.getElementById('gradeLevel').value;
            const diplomaType = document.getElementById('diplomaType').value;
            const academicLevel = document.getElementById('academicLevel').value;
            const prerequisitesFilter = document.getElementById('prerequisites').value;
            const selectedDepartments = Array.from(document.querySelectorAll('input[name="departments"]:checked'))
                .map(cb => cb.nextElementSibling.textContent);
            
            const selectedInterests = Array.from(document.querySelectorAll('input[name="interests"]:checked'))
                .map(cb => cb.nextElementSibling.textContent);
            
            const activeFilters = [];
            
            if (gradeLevel) {
                activeFilters.push(`Grade ${gradeLevel}`);
            }
            if (diplomaType) {
                activeFilters.push(diplomaType === 'regents' ? 'Regents Diploma' : 'Advanced Regents Diploma');
            }
            if (academicLevel) {
                activeFilters.push(academicLevel);
            }
            if (prerequisitesFilter) {
                const prereqNames = {
                    'none': 'No Prerequisites Required',
                    'has': 'Has Prerequisites'
                };
                activeFilters.push(prereqNames[prerequisitesFilter]);
            }
            if (selectedDepartments.length > 0) {
                activeFilters.push(`Departments: ${selectedDepartments.join(', ')}`);
            }
            if (selectedInterests.length > 0) {
                activeFilters.push(`Interests: ${selectedInterests.join(', ')}`);
            }
           
           const filterSummary = document.getElementById('filterSummary');
           const filterText = document.getElementById('filterText');
           
           if (activeFilters.length > 0) {
               filterText.textContent = activeFilters.join(' • ');
               filterSummary.style.display = 'block';
           } else {
               filterSummary.style.display = 'none';
           }
       }

               function clearAllFilters() {
            // Reset all form controls
            document.getElementById('gradeLevel').value = '';
            document.getElementById('diplomaType').value = '';
            document.getElementById('academicLevel').value = '';
            document.getElementById('prerequisites').value = '';
            
            // Uncheck all department checkboxes
            document.querySelectorAll('input[name="departments"]').forEach(cb => {
                cb.checked = false;
            });
            
            // Uncheck all interest checkboxes
            document.querySelectorAll('input[name="interests"]').forEach(cb => {
                cb.checked = false;
            });
           
           // Show all courses
           document.querySelectorAll('.course-card').forEach(card => {
               card.classList.remove('hidden');
           });
           
           // Show all departments
           document.querySelectorAll('.department-section').forEach(section => {
               section.classList.remove('hidden');
           });
           
           // Update course count
           document.getElementById('courseCount').textContent = `${courses.length} courses available`;
           
           // Hide "no courses" message
           document.getElementById('noCourses').style.display = 'none';
           
           // Hide filter summary
           document.getElementById('filterSummary').style.display = 'none';
       }

       function toggleCourseSelection(courseId) {
           if (selectedCourses.has(courseId)) {
               selectedCourses.delete(courseId);
           } else {
               selectedCourses.add(courseId);
           }
           
           updateCourseSelectionUI(courseId);
           updateSelectedCoursesDisplay();
       }

       function updateCourseSelectionUI(courseId) {
           const courseCard = document.querySelector(`[data-course-id="${courseId}"]`);
           if (!courseCard) return;
           
           const indicator = courseCard.querySelector('.course-selection-indicator');
           
           if (selectedCourses.has(courseId)) {
               courseCard.classList.add('selected');
               indicator.textContent = '✓';
           } else {
               courseCard.classList.remove('selected');
               indicator.textContent = '+';
           }
       }

       function updateSelectedCoursesDisplay() {
           const selectedCoursesContainer = document.getElementById('selectedCoursesContainer');
           const selectedCoursesDiv = document.getElementById('selectedCourses');
           const selectedCountDiv = document.getElementById('selectedCount');
           const copyBtn = document.getElementById('copyClipboardBtn');
           const emptySelection = document.getElementById('emptySelection');
           
           const selectedCount = selectedCourses.size;
           
           // Update count
           selectedCountDiv.textContent = `${selectedCount} course${selectedCount !== 1 ? 's' : ''} selected`;
           
           // Show/hide container
           if (selectedCount > 0) {
               selectedCoursesContainer.style.display = 'block';
               copyBtn.disabled = false;
               
               // Clear and rebuild selected courses list - hide empty state
               selectedCoursesDiv.innerHTML = '';
               
               // Add each selected course
               selectedCourses.forEach(courseId => {
                   const course = courses.find(c => c.id === courseId);
                   if (!course) return;
                   
                   const selectedItem = document.createElement('div');
                   selectedItem.className = 'selected-course-item';
                   
                   const gradeText = course.grade_levels.join(', ');
                   const academicLevelText = Array.isArray(course.academic_levels) ? course.academic_levels.join(', ') : course.academic_levels;
                   
                   selectedItem.innerHTML = `
                       <div class="selected-course-title">${course.title}</div>
                       <div class="selected-course-meta">${course.credits} credit${course.credits !== 1 ? 's' : ''} • Grade${course.grade_levels.length > 1 ? 's' : ''} ${gradeText} • ${academicLevelText}</div>
                       <button class="remove-course-btn" onclick="toggleCourseSelection('${courseId}')" title="Remove from selection">✕</button>
                   `;
                   
                   selectedCoursesDiv.appendChild(selectedItem);
               });
           } else {
               selectedCoursesContainer.style.display = 'none';
               copyBtn.disabled = true;
               
               // Reset to empty state
               selectedCoursesDiv.innerHTML = '<div class="empty-selection" id="emptySelection">Click on course cards below to select them for your schedule planning</div>';
           }
       }

       async function copyCoursesToClipboard() {
           const copyBtn = document.getElementById('copyClipboardBtn');
           
           if (selectedCourses.size === 0) return;
           
           // Get selected course titles
           const courseTitles = Array.from(selectedCourses)
               .map(courseId => {
                   const course = courses.find(c => c.id === courseId);
                   return course ? course.title : '';
               })
               .filter(title => title)
               .sort();
           
           const textToCopy = courseTitles.join('\n');
           
           try {
               await navigator.clipboard.writeText(textToCopy);
               
               // Show success feedback
               const originalText = copyBtn.innerHTML;
               copyBtn.innerHTML = '✅ Copied!';
               copyBtn.classList.add('copy-success');
               
               setTimeout(() => {
                   copyBtn.innerHTML = originalText;
                   copyBtn.classList.remove('copy-success');
               }, 2000);
               
           } catch (err) {
               console.error('Failed to copy to clipboard:', err);
               
               // Fallback: show alert with text to copy manually
               alert('Copy this list manually:\n\n' + textToCopy);
           }
       }

      // Initialize the application
      document.addEventListener('DOMContentLoaded', loadCourseData);
    </script>
</body>
</html>